package a.util;

import a.util.Heap;
import a.util.Comparator;

/**
 * Useful functions for the Heap. They are very unsafe, as they can
 * easily corrupt the Heap, and are primarily for use by libraries.
 */
public static class HeapUtil {

	public static void swap(int index1, int index2) {
		int temp = Heap.array[index1];
		Heap.array[index1] = Heap.array[index2];
		Heap.array[index2] = temp;
	}

	public static void copy(int src, int dest, int len) {
		if(dest > src && dest - src < len) {
			for(int i = len - 1; i >= 0; i--) {
				Heap.array[dest + i] = Heap.array[src + i];
			}
		} else {
			for(int i = 0; i < len; i++) {
				Heap.array[dest + i] = Heap.array[src + i];
			}
		}
	}
	
	//HeapSort implementation
	private static int left(int i) {
		return (i << 1) | 1;
	}
	
	private static int right(int i) {
		return (i << 1) + 2;
	}
	
	private static void maintainHeap(int index, int i, int length, Comparator<E> c) {
		while(i < length) {
			int max = i;
			
			int left = left(i);
			if(left < length && c.compare((E)Heap.array[index + left], (E)Heap.array[index + max]) > 0) {
				max = left;
			}
			int right = right(i)
			if(right < length && c.compare((E)Heap.array[index + right(i)], (E)Heap.array[index + max]) > 0) {
				max = right;
			}
			
			if(max != i) {
				swap(index + max, index + i);
				i = max;
			} else break;
		}
	}
	
	private static void buildHeap(int index, int length, Comparator<E> c) {
		for(int i = 0; i < (length >> 1), i++) {
			maintainHeap(index, i, length, c);
		}
	}
	
	/**
	 * Sorts the array starting at index with the specified length
	 * in ascending order.
	 */
	public void heapSort(int index, int length, Comparator<E> c) {
		buildHeap(index, length, c);
		while(length > 0) {
			length--;
			swap(index, index + length);
			maintainHeap(index, 0, length, c);
		}
	}
	
	/**
	 * Searches for search, assuming that the subarray is ordered according to the comparator.
	 * @return The index of the desired object, or -1 if not found.
	 */
	public static int binarySearch(int index, int length, E search, Comparator<E> c) {
		int i = 0;
		while(length > 0) {
			int half = length >> 1;
			int comp = c.compare(search, (E)Heap.array[index + i + half]);
			if(comp > 0) {
				i += half + 1;
				length -= half + 1;
			} else if(comp < 0) {
				length = half;
			} else return i;
		}
		return -1;
	}
}
